{% extends "base.html" %}
{% block title %}ğŸ” Admin-Dashboard Â· ITâ€‘Kurs{% endblock %}

{% block content %}
<div class="admin-container">
  <div class="admin-header">
    <h1>ğŸ” Admin-Dashboard</h1>
    <p>Willkommen im geschÃ¼tzten Adminâ€‘Bereich des IT-Kurses Dietikon</p>
  </div>

  <div class="admin-grid">
    <div class="admin-card participants-card">
      <h2>ğŸ‘¥ Teilnehmende verwalten</h2>
      <div class="card-content">
        <p>Verwaltung aller Kursanmeldungen, Zahlungsstatus und Teilnehmerdaten.</p>
        <div class="admin-actions">
          <a href="/teilnehmende?admin={{ token }}" class="admin-btn primary">
            ğŸ“‹ Alle anzeigen
          </a>
          <a href="/teilnehmende/new?admin={{ token }}" class="admin-btn secondary">
            â• Neu hinzufÃ¼gen
          </a>
        </div>
      </div>
    </div>

    <div class="admin-card stats-card">
      <h2>ğŸ“Š Statistiken</h2>
      <div class="card-content">
        <div class="stats-grid" id="statsGrid">
          <div class="stat-item">
            <span class="stat-number" id="totalCount">â€“</span>
            <span class="stat-label">Gesamt</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="paidCount">â€“</span>
            <span class="stat-label">Bezahlt</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="unpaidCount">â€“</span>
            <span class="stat-label">Offen</span>
          </div>
        </div>
      </div>
    </div>

    <div class="admin-card tools-card">
      <h2>ğŸ› ï¸ Tools & Export</h2>
      <div class="card-content">
        <p>Datenexport und erweiterte Verwaltungsoptionen.</p>
        <div class="admin-actions">
          <a href="/teilnehmende/export/csv?admin={{ token }}" class="admin-btn export">
            ğŸ“„ CSV Export
          </a>
          <button class="admin-btn info" onclick="loadQuickStats()">
            ğŸ”„ Stats aktualisieren
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="admin-info">
    <h3>â„¹ï¸ Hinweise</h3>
    <ul>
      <li>Alle Admin-Aktionen werden protokolliert</li>
      <li>CSV-Export enthÃ¤lt alle Teilnehmerdaten (ohne PasswÃ¶rter)</li>
      <li>Die Zahlungsmarkierung setzt automatisch das Zahlungsdatum</li>
    </ul>
  </div>
</div>

<script>
// Load statistics on page load
document.addEventListener('DOMContentLoaded', loadQuickStats);

function loadQuickStats() {
  fetch('/api/participants/stats?admin={{ token }}')
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        console.error('Stats loading failed:', data.error);
        return;
      }
      
      document.getElementById('totalCount').textContent = data.total || '0';
      document.getElementById('paidCount').textContent = data.paid || '0';
      document.getElementById('unpaidCount').textContent = data.unpaid || '0';
    })
    .catch(error => {
      console.error('Error loading stats:', error);
    });
}
</script>
{% endblock %}
